<!DOCTYPE html>
<html>
    <head>
        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <style>
            body {
                display: flex;
                min-height: 100vh;
                flex-direction: column;
              }

          main {
            flex: 1 0 auto;
          }
            
            div.container .collection#display img{
                width: 1em;
            }
    
        </style>
        
        <title>Home Auto</title>
        
        <link rel="manifest" href="/manifest.json">
    </head>

    <body>

        <nav>
            <div class="nav-wrapper">
                <a href="#" class="brand-logo">Home Auto</a>
            </div>
        </nav>
        <main>
        <div class="container">
            
            <!-- Page Content goes here -->            
            <div class="collection" id='display'>             
                <p href="#!" class="collection-item">
                    <img src="images/thermometer.png" /> Internal Temperature<span class="badge"><span id="temp-internal">...</span>℃</span>
                </p>
                <p href="#!" class="collection-item">
                    <img src="images/thermometer.png" /> External Temperature<span class="badge"><span id="temp-external">...</span>℃</span>
                </p>
                <div class="divider"></div>
                <p href="#!" class="collection-item">
                    <img src="images/sensor.png" /> Presence<span class="new badge" data-badge-caption="" id="presence">...</span>
                </p>
                <div class="divider"></div>
                <p href="#!" class="collection-item">
                    <img src="images/outlet.png" /> Relay<span class="badge" id="relay-1">...</span>
                </p>
            </div>
        </div>
            </main>
        
        <footer class="page-footer">
          <div class="container">
            <div class="row">
              <div class="col l6 s12">
              </div>
            </div>
          </div>
        </footer>

        <!--JavaScript at end of body for optimized loading-->
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <!-- update the version number as needed -->
        <script defer src="/__/firebase/4.10.0/firebase-app.js"></script>
        <!-- include only the Firebase features as you need -->
        <script defer src="/__/firebase/4.10.0/firebase-auth.js"></script>
        <script defer src="/__/firebase/4.10.0/firebase-database.js"></script>
        <script defer src="/__/firebase/4.10.0/firebase-messaging.js"></script>
        <script defer src="/__/firebase/4.10.0/firebase-storage.js"></script>
        <!-- initialize the SDK after all desired features are loaded -->
        <script defer src="/__/firebase/init.js"></script>
        
        <script>
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker
                         .register('./service-worker.js')
                         .then(function() { console.log('Service Worker Registered'); });
            }
            
            var config;
            var sensor;
              $(document).ready(function(){
                var database = firebase.database().ref('/');

                database.on('value', function(snapshot) {
                  config = snapshot.val().config;
                  sensor = snapshot.val().data;
                  update();
                });
              });
              function update(){
                $('#temp-internal').text(sensor.sensors.temperature.internal.reading.toPrecision(4));
                $('#temp-external').text(sensor.sensors.temperature.external.reading.toPrecision(4));

                $('#presence').text(sensor.sensors.presence.reading == 1 ? "Present" : "None");
                if (sensor.sensors.presence.reading == 1) {$('#presence').addClass('new')} else {{$('#presence').removeClass('new')}}

                $('#relay-1').text(sensor.relay.relay1.state == 1 ? "On" : "Off");
                if (sensor.sensors.presence.reading == 1) {$('#relay-1').addClass('new')} else {{$('#relay-1').removeClass('new')}}
              }
        </script>
    </body>
</html>